<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complaint Dashboard</title>
    <style>
        /* Same CSS as before */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 40px;
        }

        .dashboard {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 40px;
            border-radius: 12px;
            margin-bottom: 35px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .header p {
            font-size: 1.5em;
            color: #555;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 35px;
            margin-bottom: 35px;
        }

        .card {
            background: white;
            padding: 35px;
            border-radius: 12px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }

        .card h2 {
            margin-bottom: 25px;
            color: #333;
            border-bottom: 3px solid #007bff;
            padding-bottom: 10px;
            font-size: 2em;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            font-size: 1.3em;
            color: #555;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 18px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1.2em;
        }

        .form-group textarea {
            height: 200px;
            resize: vertical;
        }

        .btn {
            background: #007bff;
            color: white;
            padding: 18px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2em;
            margin-right: 15px;
            margin-bottom: 15px;
        }

        .btn:hover {
            background: #0056b3;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #1e7e34;
        }

        .btn-info {
            background: #17a2b8;
        }

        .btn-info:hover {
            background: #117a8b;
        }

        .suggestions {
            background: #e9f7ff;
            border: 1px solid #b8e6ff;
            padding: 25px;
            border-radius: 8px;
            margin-top: 25px;
        }

        .suggestions h3 {
            color: #0066cc;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .suggestion-item {
            background: white;
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 8px;
            border-left: 5px solid #007bff;
            font-size: 1.2em;
        }

        .rights-section {
            grid-column: span 2;
            background: white;
            padding: 35px;
            border-radius: 12px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
            margin-top: 35px;
        }

        .rights-section h2 {
            font-size: 2.2em;
            margin-bottom: 15px;
        }

        .rights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }

        .right-item {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            border-left: 6px solid #28a745;
            cursor: pointer;
            font-size: 1.2em;
            transition: transform 0.2s;
        }

        .right-item:hover {
            transform: scale(1.03);
        }

        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 14px;
            font-size: 14px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-resolved {
            background: #d4edda;
            color: #155724;
        }

        .hidden {
            display: none;
        }

        @media(max-width:1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .rights-section {
                grid-column: span 1;
            }
        }

        .complaint-history {
            margin-top: 30px;
        }

        .complaint-item {
            background: #f8f9fa;
            padding: 22px;
            margin-bottom: 15px;
            border-radius: 8px;
            border-left: 5px solid #6c757d;
            font-size: 1.2em;
        }
    </style>
    <script type="module" src="dashboard.js"></script>
    

</head>

<body>
    <div class="dashboard">

        <div class="header"
            style="position: relative; display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h1>Complaint Management Dashboard</h1>
                <p>Submit complaints and explore your rights</p>
            </div>
            <div style="display: flex; align-items: center; gap: 15px;">
                <!-- User Icon -->
                <img src="https://cdn-icons-png.flaticon.com/512/1946/1946429.png" alt="User Icon"
                    style="width:40px; height:40px; border-radius:50%;">
                <!-- Username -->
                <span id="username" style="font-weight:bold; font-size:1.2em;">Guest</span>
                <!-- Logout Button -->
                <button id="logoutBtn" class="btn btn-info" style="padding:8px 16px; font-size:1em;"><a href="loginpage.html" style="padding:5px 12px; color:white; text-decoration:none; border-radius:5px;">Logout</a></button>
            </div>
        </div>



        <div class="main-content">
            <div class="card">
                <h2>Submit New Complaint</h2>
                <form id="complaintForm">
                    <div class="form-group">
                        <label for="complaintType">Complaint Type</label>
                        <select id="complaintType" name="complaintType">
                            <option value="">Select complaint type</option>
                            <option value="product_defect">Product Defect</option>
                            <option value="service_issue">Service Issue</option>
                            <option value="billing_problem">Billing Problem</option>
                            <option value="delivery_delay">Delivery Delay</option>
                            <option value="customer_service">Customer Service</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="subject">Subject</label>
                        <input type="text" id="subject" name="subject" placeholder="Brief description of the issue">
                    </div>

                    <div class="form-group">
                        <label for="description">Detailed Description</label>
                        <textarea id="description" name="description"
                            placeholder="Please describe your issue in detail"></textarea>
                    </div>

                    <button type="submit" class="btn">Submit Complaint</button>
                    <button type="button" class="btn btn-info" onclick="getSuggestions()">Get AI Suggestions</button>
                </form>

                <div id="suggestionsContainer" class="suggestions hidden">
                    <h3>Suggested Actions</h3>
                    <div id="suggestionsContent"></div>
                </div>
            </div>

            <div class="card">
                <h2>Quick Actions</h2>
                <a href="rights.html"
                    style="display:inline-block; padding:20px 20px; background-color:green; color:white; text-decoration:none; border-radius:10px;">
                    View My Rights
                </a>

                <div class="complaint-history">
                    <h3>Recent Complaints</h3>
                    <div id="recentComplaintsContainer"></div>
                </div>

                <button class="btn" onclick="trackComplaint()">Track Complaint</button>
                <a href="contact.html" style="display:inline-block; 
                   padding:10px 40px; 
                   background-color:#17a2b8; 
                   color:white; 
                   text-decoration:none; 
                   border-radius:4px; 
                   font-size:16px; 
                   font-weight:bold; 
                   text-align:center; 
                   width:200px; 
                   box-sizing:border-box;">
                    Contact Support
                </a>
            </div>
        </div>

        <div class="rights-section hidden" id="rightsSection">
            <h2>Your Consumer Rights</h2>
            <p>These are your fundamental rights as a consumer. Click on any right to learn more.</p>
            <div class="rights-grid">
                <div class="right-item" onclick="showRightDetails('right_to_return')">
                    <h4>Right to Return</h4>
                    <p>You have the right to return products within a specified period if they don't meet your
                        expectations.</p>
                </div>
                <div class="right-item" onclick="showRightDetails('right_to_refund')">
                    <h4>Right to Refund</h4>
                    <p>You're entitled to a full refund for defective products or unsatisfactory services.</p>
                </div>
                <div class="right-item" onclick="showRightDetails('right_to_repair')">
                    <h4>Right to Repair</h4>
                    <p>You have the right to have defective products repaired at no additional cost.</p>
                </div>
                <div class="right-item" onclick="showRightDetails('right_to_information')">
                    <h4>Right to Information</h4>
                    <p>You have the right to clear, accurate information about products and services.</p>
                </div>
                <div class="right-item" onclick="showRightDetails('right_to_safety')">
                    <h4>Right to Safety</h4>
                    <p>Products and services should not pose any risk to your health or safety.</p>
                </div>
                <div class="right-item" onclick="showRightDetails('right_to_choice')">
                    <h4>Right to Choice</h4>
                    <p>You have the right to choose from a variety of products at competitive prices.</p>
                </div>
            </div>
        </div>

        <div id="rightDetailsModal" class="card hidden"
            style="position: fixed; top:50%; left:50%; transform: translate(-50%, -50%); z-index:1000; width:90%; max-width:700px; background:white; border:2px solid #007bff;">
            <h3 id="rightTitle"></h3>
            <div id="rightContent"></div>
            <button class="btn" onclick="closeRightDetails()">Close</button>
        </div>
    </div>

    <script>

        // Fetch and display last 2 real complaints for the logged-in user
        let recentComplaints = [];
        let firebase_uid = '';
        let email = '';

        // Get user info from Firebase (if available) in firebase
        window.addEventListener('DOMContentLoaded', () => {
            if (window.auth && window.auth.currentUser) {
                firebase_uid = window.auth.currentUser.uid;
                email = window.auth.currentUser.email;
            } else {
                // fallback to demo
                firebase_uid = 'demo-user-uid';
                email = 'demo@example.com';
            }
            fetchAndDisplayComplaints();
        });

        function fetchAndDisplayComplaints() {
            fetch(`http://localhost:5000/api/complaints/my?firebase_uid=${firebase_uid}`)
                .then(res => res.json())
                .then(complaints => {
                    recentComplaints = complaints.slice(0, 2);
                    updateRecentComplaints();
                })
                .catch(err => {
                    console.error('Error fetching complaints:', err);
                });
        }

        document.getElementById('complaintForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(this);
            const complaintData = Object.fromEntries(formData);
            complaintData.firebase_uid = firebase_uid;
            complaintData.email = email;

            fetch('http://localhost:5000/api/complaints/submit', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    firebase_uid: complaintData.firebase_uid,
                    email: complaintData.email,
                    type: complaintData.complaintType,
                    subject: complaintData.subject,
                    description: complaintData.description
                })
            })
            .then(res => res.json())
            .then(data => {
                alert(data.message || 'Complaint submitted!');
                fetchAndDisplayComplaints();
                document.getElementById('complaintForm').reset();
                document.getElementById('suggestionsContainer').classList.add('hidden');
            })
            .catch(err => {
                alert('Error submitting complaint. Please try again.');
                console.error(err);
            });
        });

        function updateRecentComplaints() {
            const container = document.getElementById('recentComplaintsContainer');
            container.innerHTML = recentComplaints.map(c => `
                <div class="complaint-item">
                    <strong>${(c.type || c.complaintType || '').replace('_', ' ')} - #${c.id || ''}</strong>
                    <span class="status-badge status-${(c.status || 'pending').toLowerCase()}">${c.status || 'Pending'}</span>
                    <p>Subject: ${c.subject}</p>
                    <p>Description: ${c.description}</p>
                </div>
            `).join('');
        }

        // Gemini API Integration (via backend)
        async function getSuggestions() {
            const complaintType = document.getElementById('complaintType').value;
            if (!complaintType) { alert('Please select a complaint type first'); return; }

            const suggestionsContainer = document.getElementById('suggestionsContainer');
            const suggestionsContent = document.getElementById('suggestionsContent');

            try {
                const response = await fetch('http://localhost:5000/api/gemini/suggest', {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ complaintType })
                });
                const data = await response.json();
                if (data.suggestions && data.suggestions.length > 0) {
                    suggestionsContent.innerHTML = data.suggestions.map(s => `<div class="suggestion-item">${s}</div>`).join('');
                } else {
                    suggestionsContent.innerHTML = `<div class="suggestion-item">${data.error || "AI could not generate suggestions. Try again."}</div>`;
                }
                suggestionsContainer.classList.remove('hidden');
            } catch (err) {
                console.error(err);
                suggestionsContent.innerHTML = `<div class="suggestion-item">Error fetching AI suggestions. Try again later.</div>`;
                suggestionsContainer.classList.remove('hidden');
            }
        }

        const rightsInfo = { //'right_to_return': {title:'Right to Return Products',content:'<p><strong>What it means:</strong> You can return products within a reasonable timeframe if they don\'t meet your expectations.</p><p><strong>Time limit:</strong> Usually 14-30 days depending on the product and retailer.</p><p><strong>Conditions:</strong> Products should be in original condition unless defective.</p><p><strong>How to exercise:</strong> Contact the retailer with your receipt and explain the reason for return.</p>'},
            //     'right_to_refund': {title:'Right to Full Refund',content:'<p><strong>What it means:</strong> You\'re entitled to get your money back for defective or unsatisfactory products/services.</p><p><strong>When applicable:</strong> Product defects, service failures, misrepresentation, or breach of contract.</p><p><strong>Process:</strong> Contact the seller first, then escalate to consumer protection if needed.</p><p><strong>Documentation:</strong> Keep receipts, warranties, and communication records.</p>'},
            //     'right_to_repair': {title:'Right to Repair or Replacement',content:'<p><strong>What it means:</strong> Defective products should be repaired or replaced at no cost to you.</p><p><strong>Warranty period:</strong> Applies during warranty period or reasonable expectation of product life.</p><p><strong>Options:</strong> Repair, replacement, or refund - usually seller\'s choice initially.</p><p><strong>Timeline:</strong> Repairs should be completed within reasonable timeframe.</p>'},
            //     'right_to_information': {title:'Right to Clear Information',content:'<p><strong>What it means:</strong> You have the right to accurate, clear information about products and services.</p><p><strong>Includes:</strong> Price, features, limitations, terms and conditions, warranties.</p><p><strong>Protection:</strong> Against misleading advertisements and hidden terms.</p><p><strong>Remedies:</strong> Compensation for losses due to misinformation.</p>'},
            //     'right_to_safety': {title:'Right to Safe Products',content:'<p><strong>What it means:</strong> Products and services should not harm your health or safety.</p><p><strong>Standards:</strong> Must meet safety regulations and industry standards.</p><p><strong>Recalls:</strong> Right to be informed about product recalls and safety issues.</p><p><strong>Compensation:</strong> Right to compensation for injuries caused by unsafe products.</p>'},
            //     'right_to_choice': {title:'Right to Choose',content:'<p><strong>What it means:</strong> Access to variety of products at competitive prices without unfair practices.</p><p><strong>Fair competition:</strong> Protection against monopolistic practices.</p><p><strong>Price transparency:</strong> Clear pricing without hidden charges.</p><p><strong>No coercion:</strong> Right to make decisions without undue pressure.</p>'}
        };

        function showRightDetails(key) {
            const modal = document.getElementById('rightDetailsModal');
            const title = document.getElementById('rightTitle');
            const content = document.getElementById('rightContent');
            const info = rightsInfo[key];
            if (info) { title.textContent = info.title; content.innerHTML = info.content; modal.classList.remove('hidden'); }
        }
        function closeRightDetails() { document.getElementById('rightDetailsModal').classList.add('hidden'); }
        function showRights() { const r = document.getElementById('rightsSection'); r.classList.toggle('hidden'); if (!r.classList.contains('hidden')) r.scrollIntoView({ behavior: 'smooth' }); }
        function trackComplaint() { const id = prompt('Enter your complaint ID:'); if (id) { alert(`Tracking complaint ${id}:\nStatus: Under Review\nEstimated resolution: 3-5 business days\nNext update: Tomorrow at 2:00 PM`); } }
        function contactSupport() { alert('Support Contact Information:\nPhone: 1-800-SUPPORT\nEmail: support@company.com\nLive Chat: Available 24/7\nOffice Hours: Mon-Fri 9AM-6PM'); }

        document.addEventListener('click', function (e) { if (e.target === document.getElementById('rightDetailsModal')) closeRightDetails(); });
    </script>
</body>

</html>